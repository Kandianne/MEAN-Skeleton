!function(){"use strict";function e(e,t,n,r,o,i){r.caseInsensitive(!0),r.strictMode(!1),e.state("Home",{url:"/",templateUrl:"templates/home.html",controller:"HomeController as vm"}).state("Register",{url:"/Register",templateUrl:"templates/register.html",controller:"RegisterController as vm"}),t.otherwise("/"),o.html5Mode(!0),i.setPermissions("email"),i.setAppId(838183259630461)}function t(){!function(e,t,n){var r,o=e.getElementsByTagName(t)[0];e.getElementById(n)||(r=e.createElement(t),r.id=n,r.src="//connect.facebook.net/en_US/sdk.js",o.parentNode.insertBefore(r,o))}(document,"script","facebook-jssdk")}angular.module("app",["ui.router","ngMaterial","ngMdIcons","ngMessages","ngFacebook"]).config(e).run(t),e.$inject=["$stateProvider","$urlRouterProvider","$httpProvider","$urlMatcherFactoryProvider","$locationProvider","$facebookProvider"]}(),angular.module("ngFacebook",[]).provider("$facebook",function(){var e={permissions:"email",appId:null,version:"v1.0",customInit:{}};this.setAppId=function(t){return e.appId=t,this},this.getAppId=function(){return e.appId},this.setVersion=function(t){return e.version=t,this},this.getVersion=function(){return e.version},this.setPermissions=function(t){return t instanceof Array&&t.join(","),e.permissions=t,this},this.getPermissions=function(){return e.permissions},this.setCustomInit=function(t){return angular.isDefined(t.appId)&&this.setAppId(t.appId),e.customInit=t,this},this.getCustomInit=function(){return e.customInit},this.$get=["$q","$rootScope","$window",function(t,n,r){function o(e){c||(c=!0,a.resolve(e))}var i=t.defer();i.config=function(t){return e[t]},i.init=function(){if(null==i.config("appId"))throw"$facebookProvider: `appId` cannot be null";r.FB.init(angular.extend({appId:i.config("appId"),version:i.config("version")},i.config("customInit"))),n.$broadcast("fb.load",r.FB)},n.$on("fb.load",function(e,t){i.resolve(t),angular.forEach(["auth.login","auth.logout","auth.prompt","auth.sessionChange","auth.statusChange","auth.authResponseChange","xfbml.render","edge.create","edge.remove","comment.create","comment.remove","message.send"],function(e){t.Event.subscribe(e,function(r){n.$broadcast("fb."+e,r,t),n.$$phase||n.$apply()})}),i.getLoginStatus()}),i._cache={},i.setCache=function(e,t){i._cache[e]=t},i.getCache=function(e){return angular.isUndefined(i._cache[e])?!1:i._cache[e]},i.clearCache=function(){i._cache={}};var a=t.defer(),c=!1;return i.setCache("connected",null),i.isConnected=function(){return i.getCache("connected")},n.$on("fb.auth.authResponseChange",function(e,t,n){i.clearCache(),"connected"==t.status?i.setCache("connected",!0):i.setCache("connected",!1),o(n)}),i.getAuthResponse=function(){return FB.getAuthResponse()},i.getLoginStatus=function(e){var r=t.defer();return i.promise.then(function(t){return t.getLoginStatus(function(e){e.error?r.reject(e.error):(r.resolve(e),null==i.isConnected()&&n.$broadcast("fb.auth.authResponseChange",e,t)),n.$$phase||n.$apply()},e),r.promise})},i.login=function(e,r){void 0==e&&(e=i.config("permissions"));var o=t.defer(),a={scope:e};return r&&(a.auth_type="rerequest"),i.promise.then(function(e){return e.login(function(e){e.error?o.reject(e.error):o.resolve(e),n.$$phase||n.$apply()},a),o.promise})},i.logout=function(){var e=t.defer();return i.promise.then(function(t){return t.logout(function(t){t.error?e.reject(t.error):e.resolve(t),n.$$phase||n.$apply()}),e.promise})},i.ui=function(e){var r=t.defer();return i.promise.then(function(t){return t.ui(e,function(e){e&&e.error_code?r.reject(e.error_message):r.resolve(e),n.$$phase||n.$apply()}),r.promise})},i.api=function(){var e=t.defer(),r=arguments;return r[r.length++]=function(t){t.error&&e.reject(t.error),t.error_msg?e.reject(t):e.resolve(t),n.$$phase||n.$apply()},a.promise.then(function(t){return t.api.apply(t,r),e.promise})},i.cachedApi=function(){if("string"!=typeof arguments[0])throw"$facebook.cacheApi can works only with graph requests!";var e=i.getCache(arguments[0]);if(e)return e;var t=i.api.apply(i,arguments);return i.setCache(arguments[0],t),t},i}]}).run(["$rootScope","$window","$facebook",function(e,t,n){t.fbAsyncInit=function(){n.init(),e.$$phase||e.$apply()}}]),function(){"use strict";function e(){}angular.module("app").controller("HomeController",e)}(),function(){"use strict";function e(e,t){var n=this;n.user={},n.register=function(){t.register(n.user).then(function(){e.go("Home")})}}angular.module("app").controller("RegisterController",e),e.$inject=["$state","UserFactory"]}(),function(){"use strict";function e(e){var t={request:function(t){return e.localStorage.getItem("token")&&(t.headers.authorization="Bearer "+e.localStorage.getItem("token")),t}};return t}angular.module("app").factory("AuthInterceptor",e),e.$inject=["$window"]}(),function(){"use strict";function e(e,t,n){function r(n){var r=t.defer();return e.post("/api/Users/Register",n).then(function(e){s(e.data.token),f(),r.resolve()}),r.promise}function o(n){var r={email:n.email.toLowerCase(),password:n.password},o=t.defer();return e.post("/api/Users/Login",r).then(function(e){s(e.data.token),f(),o.resolve()},function(e){e.data.err?o.reject(e.data.err):o.reject()}),o.promise}function i(e){s(e),f()}function a(){v(),l()}function c(){var n=t.defer();return e.get("/api/Users/profile").then(function(e){n.resolve(e.data)},function(){n.reject()}),n.promise}function s(e){n.localStorage.setItem("token",e)}function u(){return n.localStorage.getItem("token")}function l(){n.localStorage.removeItem("token")}function f(){var e=JSON.parse($(u().split(".")[1]));I.username=e.username,I._id=e._id,I.email=e.email,I.isLoggedIn=!0,I.facebook=e.facebook,I.twitter=e.twitter,I.google=e.google,I.local=e.local}function p(n){var r=t.defer();return e.post("/api/Users/connect/facebook",n).then(function(e){s(e.data.token),f(),r.resolve(e)},function(e){r.reject(e)}),r.promise}function g(){var n=t.defer();return e.get("/api/Users/connect/twitter").then(function(e){console.log(e),n.resolve(e.data.token)},function(e){console.error(e)}),n.promise}function d(){var n=t.defer();return e.get("/api/Users/connect/google").then(function(e){n.resolve(e.data.url)},function(e){console.log(e),n.reject(e)}),n.promise}function h(n){var r=t.defer();return e.post("/api/Users/connect/local",n).then(function(e){s(e.data.token),f(),r.resolve()},function(e){"object"==typeof e.data&&(e=e.data.err),r.reject(e)}),r.promise}function m(n,r){var o=t.defer();return e.put("/api/Users/disconnect/"+n,{password:r}).then(function(e){s(e.data.token),f(),o.resolve()},function(e){e.data.err?o.reject(e.data.err):o.reject()}),o.promise}function v(){I.username=null,I.email=null,I._id=null,I.isLoggedIn=!1,I.facebook=!1,I.twitter=!1,I.google=!1,I.local=!1}function $(e){var t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw"Illegal base64url string!"}return decodeURIComponent(encodeURIComponent(n.atob(t)))}var I={},b={status:I,register:r,login:o,logout:a,externalLogin:i,getUser:c,connectFacebook:p,connectTwitter:g,connectGoogle:d,connectLocal:h,disconnectFromProvider:m,setToken:s,setUser:f};return u()&&f(),b}angular.module("app").factory("UserFactory",e),e.$inject=["$http","$q","$window"]}();