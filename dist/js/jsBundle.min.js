!function(){"use strict";function e(e,t,n,o,r,a){o.caseInsensitive(!0),o.strictMode(!1),e.state("Home",{url:"/",templateUrl:"templates/home.html",controller:"HomeController as vm"}).state("Login",{url:"/login",templateUrl:"templates/login.html",controller:"LoginController as vm"}).state("Register",{url:"/register",templateUrl:"templates/register.html",controller:"RegisterController as vm"}),t.otherwise("/"),r.html5Mode(!0),a.setPermissions("email"),a.setAppId(838183259630461)}function t(){!function(e,t,n){var o,r=e.getElementsByTagName(t)[0];e.getElementById(n)||(o=e.createElement(t),o.id=n,o.src="//connect.facebook.net/en_US/sdk.js",r.parentNode.insertBefore(o,r))}(document,"script","facebook-jssdk")}angular.module("app",["ui.router","ngMaterial","ngMdIcons","ngMessages","ngFacebook"]).config(e).run(t),e.$inject=["$stateProvider","$urlRouterProvider","$httpProvider","$urlMatcherFactoryProvider","$locationProvider","$facebookProvider"]}(),angular.module("ngFacebook",[]).provider("$facebook",function(){var e={permissions:"email",appId:null,version:"v1.0",customInit:{}};this.setAppId=function(t){return e.appId=t,this},this.getAppId=function(){return e.appId},this.setVersion=function(t){return e.version=t,this},this.getVersion=function(){return e.version},this.setPermissions=function(t){return t instanceof Array&&t.join(","),e.permissions=t,this},this.getPermissions=function(){return e.permissions},this.setCustomInit=function(t){return angular.isDefined(t.appId)&&this.setAppId(t.appId),e.customInit=t,this},this.getCustomInit=function(){return e.customInit},this.$get=["$q","$rootScope","$window",function(t,n,o){function r(e){c||(c=!0,i.resolve(e))}var a=t.defer();a.config=function(t){return e[t]},a.init=function(){if(null==a.config("appId"))throw"$facebookProvider: `appId` cannot be null";o.FB.init(angular.extend({appId:a.config("appId"),version:a.config("version")},a.config("customInit"))),n.$broadcast("fb.load",o.FB)},n.$on("fb.load",function(e,t){a.resolve(t),angular.forEach(["auth.login","auth.logout","auth.prompt","auth.sessionChange","auth.statusChange","auth.authResponseChange","xfbml.render","edge.create","edge.remove","comment.create","comment.remove","message.send"],function(e){t.Event.subscribe(e,function(o){n.$broadcast("fb."+e,o,t),n.$$phase||n.$apply()})}),a.getLoginStatus()}),a._cache={},a.setCache=function(e,t){a._cache[e]=t},a.getCache=function(e){return angular.isUndefined(a._cache[e])?!1:a._cache[e]},a.clearCache=function(){a._cache={}};var i=t.defer(),c=!1;return a.setCache("connected",null),a.isConnected=function(){return a.getCache("connected")},n.$on("fb.auth.authResponseChange",function(e,t,n){a.clearCache(),"connected"==t.status?a.setCache("connected",!0):a.setCache("connected",!1),r(n)}),a.getAuthResponse=function(){return FB.getAuthResponse()},a.getLoginStatus=function(e){var o=t.defer();return a.promise.then(function(t){return t.getLoginStatus(function(e){e.error?o.reject(e.error):(o.resolve(e),null==a.isConnected()&&n.$broadcast("fb.auth.authResponseChange",e,t)),n.$$phase||n.$apply()},e),o.promise})},a.login=function(e,o){void 0==e&&(e=a.config("permissions"));var r=t.defer(),i={scope:e};return o&&(i.auth_type="rerequest"),a.promise.then(function(e){return e.login(function(e){e.error?r.reject(e.error):r.resolve(e),n.$$phase||n.$apply()},i),r.promise})},a.logout=function(){var e=t.defer();return a.promise.then(function(t){return t.logout(function(t){t.error?e.reject(t.error):e.resolve(t),n.$$phase||n.$apply()}),e.promise})},a.ui=function(e){var o=t.defer();return a.promise.then(function(t){return t.ui(e,function(e){e&&e.error_code?o.reject(e.error_message):o.resolve(e),n.$$phase||n.$apply()}),o.promise})},a.api=function(){var e=t.defer(),o=arguments;return o[o.length++]=function(t){t.error&&e.reject(t.error),t.error_msg?e.reject(t):e.resolve(t),n.$$phase||n.$apply()},i.promise.then(function(t){return t.api.apply(t,o),e.promise})},a.cachedApi=function(){if("string"!=typeof arguments[0])throw"$facebook.cacheApi can works only with graph requests!";var e=a.getCache(arguments[0]);if(e)return e;var t=a.api.apply(a,arguments);return a.setCache(arguments[0],t),t},a}]}).run(["$rootScope","$window","$facebook",function(e,t,n){t.fbAsyncInit=function(){n.init(),e.$$phase||e.$apply()}}]),function(){"use strict";function e(e,t){var n=e.search();n.code&&(t.setToken(n.code),t.setUser(),e.search("code",null))}angular.module("app").controller("HomeController",e),e.$inject=["$location","UserFactory"]}(),function(){"use strict";function e(e){}angular.module("app").controller("LoginController",e),e.$inject=["UserFactory"]}(),function(){"use strict";function e(e,t){var n=this;n.status=e.status,n.logout=function(){e.logout(),t.go("Home")}}angular.module("app").controller("NavController",e),e.$inject=["UserFactory","$state"]}(),function(){"use strict";function e(e){}angular.module("app").controller("RegisterController",e),e.$inject=["UserFactory"]}(),function(){"use strict";function e(e){var t={request:function(t){return e.localStorage.getItem("token")&&(t.headers.authorization="Bearer "+e.localStorage.getItem("token")),t}};return t}angular.module("app").factory("AuthInterceptor",e),e.$inject=["$window"]}(),function(){"use strict";function e(e,t,n){function o(n){var o=t.defer();return e.post("/api/v1/users/Register",n).then(function(e){s(e.data.token),f(),o.resolve()}),o.promise}function r(n){var o={email:n.email.toLowerCase(),password:n.password},r=t.defer();return e.post("/api/v1/users/Login",o).then(function(e){s(e.data.token),f(),r.resolve()},function(e){e.data.err?r.reject(e.data.err):r.reject()}),r.promise}function a(e){s(e),f()}function i(){v(),l()}function c(){var n=t.defer();return e.get("/api/v1/users/profile").then(function(e){n.resolve(e.data)},function(){n.reject()}),n.promise}function s(e){n.localStorage.setItem("token",e)}function u(){return n.localStorage.getItem("token")}function l(){n.localStorage.removeItem("token")}function f(){var e=JSON.parse($(u().split(".")[1]));I.username=e.username,I._id=e._id,I.email=e.email,I.isLoggedIn=!0,I.facebook=e.facebook,I.twitter=e.twitter,I.google=e.google,I.local=e.local}function p(n){var o=t.defer();return e.post("/api/v1/users/connect/facebook",n).then(function(e){s(e.data.token),f(),o.resolve(e)},function(e){o.reject(e)}),o.promise}function g(){var n=t.defer();return e.get("/api/v1/users/connect/twitter").then(function(e){console.log(e),n.resolve(e.data.token)},function(e){console.error(e)}),n.promise}function d(){var n=t.defer();return e.get("/api/v1/users/connect/google").then(function(e){n.resolve(e.data.url)},function(e){console.log(e),n.reject(e)}),n.promise}function m(n){var o=t.defer();return e.post("/api/v1/users/connect/local",n).then(function(e){s(e.data.token),f(),o.resolve()},function(e){"object"==typeof e.data&&(e=e.data.err),o.reject(e)}),o.promise}function h(n,o){var r=t.defer();return e.put("/api/v1/users/disconnect/"+n,{password:o}).then(function(e){s(e.data.token),f(),r.resolve()},function(e){e.data.err?r.reject(e.data.err):r.reject()}),r.promise}function v(){I.username=null,I.email=null,I._id=null,I.isLoggedIn=!1,I.facebook=!1,I.twitter=!1,I.google=!1,I.local=!1}function $(e){var t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw"Illegal base64url string!"}return decodeURIComponent(encodeURIComponent(n.atob(t)))}var I={},b={status:I,register:o,login:r,logout:i,externalLogin:a,getUser:c,connectFacebook:p,connectTwitter:g,connectGoogle:d,connectLocal:m,disconnectFromProvider:h,setToken:s,setUser:f};return u()&&f(),b}angular.module("app").factory("UserFactory",e),e.$inject=["$http","$q","$window"]}();